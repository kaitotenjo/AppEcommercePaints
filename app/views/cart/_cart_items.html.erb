
<script src="https://www.paypal.com/sdk/js?client-id=ATyxGFKos4swuTzF3lxNy0e4nMsBoWVJqIvVMYMzSVZvaj99-fOHT6bceySsl9VIPwAAByWEEwIuQfPw"></script>
<section class="shoping-cart spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="shoping__cart__table">
                        <table>
                            <thead>
                                <tr>
                                    <th class="shoping__product">Products</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            <% @order_items.each do |item| %>
                            <%if item.order_id == current_order.id && current_order.user_id == current_user.id%>
                                <tr>
                                    <td class="shoping__cart__item">
                                        <img src="../assets/paint/<%= item.paint.color%>" width="100" height="100" >
                                        <h4><%= item.paint.name%></h4>
                                    </td>
                                    <td class="shoping__cart__price">
                                        <%= item.paint.price %> đ
                                    </td>
                                    <%= form_with model: item do |f|%>
                                    <td class="shoping__cart__quantity">
                                        <div class="quantity">
                                            <div class="pro-qty">
                                            <%= f.hidden_field :paint_id, value: item.paint.id %>
                                            <%= f.number_field :quantity, value: item.quantity.to_i%>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <td class="shoping__cart__total">
                                      <%= item.total %> đ
                                    </td>
                                     <td >
                                      <button class="btn btn-primary" type="submit">update cart</button>
                                    </td>
                                    <td>
                                    <button class="btn btn-default" type="button"><%= link_to "Remove Items", item, method: :delete, remote: true %></button>
                                    </td>
                                    
                                    <% end%>
                                </tr>
                                <%end%>
                                <% end %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="shoping__cart__btns">
                        <a href="#" class="primary-btn cart-btn">CONTINUE SHOPPING</a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="shoping__checkout">
                        <h5>Cart Total</h5>
                        <ul>
                        <%if current_order.status=="0" || current_order.status=="1"  %>
                            <li>Subtotal <span> <%= current_order.subtotal %> đ</span></li>
                            <li>Total <span> <%= current_order.subtotal %> đ</span></li>
                        <%else%>
                            <li>the order is being processed </li>
                        <%end%>
                    
                        
                        </ul>
                        <%if current_order.status=="0" %>
                         <div id="paypal-button-container" ></div>
                         <%else%>
                         <a href="#" class="primary-btn">the order is being processed</a>
                         <%end%>
                    </div>
                </div>
            </div>
        </div>
    </section>
<script>
  paypal.Buttons({
    createOrder: function (data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: <%=  current_order.subtotal/22000%> 
          }
        }]
      });
    },
    onApprove: function (data, actions) {
    location.replace("http://localhost:3000");
      $.ajax({
        url: '/cart_update',
        method: 'POST',
        dataType: 'json',
        data: JSON.stringify({
          'order_id': data.orderID,
          'payer_id': data.payerID
        }),
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': $('meta[name="csrf-token"]').content
        }
      }).then(function () {
        alert("Thanh toán thành công!");
      });
}
  }).render('#paypal-button-container');
</script>